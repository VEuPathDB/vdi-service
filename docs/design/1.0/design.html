<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>VEuPathDB Dataset Installer System</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>VEuPathDB Dataset Installer System</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_queues">Queues</a>
<ul class="sectlevel2">
<li><a href="#_import_queue">Import Queue</a></li>
<li><a href="#_dataset_store_queue">Dataset Store Queue</a></li>
<li><a href="#_action_queue">Action Queue</a></li>
</ul>
</li>
<li><a href="#_dataset_store">Dataset Store</a></li>
<li><a href="#_vdi_service">VDI Service</a>
<ul class="sectlevel2">
<li><a href="#_api_actions">API Actions</a></li>
<li><a href="#_internal_actions">Internal Actions</a></li>
<li><a href="#_old_actions">[OLD] Actions</a></li>
</ul>
</li>
<li><a href="#_import_handler_service">Import Handler Service</a>
<ul class="sectlevel2">
<li><a href="#_actions">Actions</a></li>
</ul>
</li>
<li><a href="#_general_q_a">General Q &amp; A</a></li>
<li><a href="#_general_implementation_notes_thoughts">General Implementation Notes / Thoughts</a></li>
<li><a href="#_unorganized_notes">Unorganized Notes</a>
<ul class="sectlevel2">
<li><a href="#_submitting_a_user_dataset">Submitting a User Dataset</a></li>
<li><a href="#_internal_processing_an_import">[Internal] Processing an Import</a></li>
</ul>
</li>
<li><a href="#_misc_notes">Misc Notes</a>
<ul class="sectlevel2">
<li><a href="#_statuses">Statuses</a></li>
<li><a href="#_shares">Shares</a></li>
<li><a href="#_misc_diagrams">Misc Diagrams</a></li>
</ul>
</li>
<li><a href="#_database_schemata">Database Schemata</a>
<ul class="sectlevel2">
<li><a href="#_internal_postgresql_database">Internal PostgreSQL Database</a></li>
<li><a href="#_application_database">Application Database</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_queues">Queues</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_import_queue">Import Queue</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>TODO</strong>: Describe the import queue.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_dataset_store_queue">Dataset Store Queue</h3>
<div class="paragraph">
<p>Message queue that is delivered messages for every change to any object in the
dataset store.</p>
</div>
<div class="paragraph">
<p>These messages must be filtered down and translated into actions that can be
acted on to process changes to, installations of, or deletions of datasets.</p>
</div>
</div>
<div class="sect2">
<h3 id="_action_queue">Action Queue</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>TODO</strong>: Describe the action queue.  (the queue right before the project multiplexer)</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dataset_store">Dataset Store</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dataset Store = Minio</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>TODO</strong>: Describe the data store.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vdi_service">VDI Service</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_api_actions">API Actions</h3>
<div class="paragraph">
<p>Service actions that are exposed through and executed via the HTTP API.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 10%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Action</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_list_available_datasets">List Available Datasets</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List the datasets available to the requesting user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_upload_dataset">Upload Dataset</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upload a new dataset.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_lookup_dataset">Lookup Dataset</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lookup an existing dataset that is owned by or has been shared with the
requesting user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_update_dataset_metadata">Update Dataset Metadata</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update the metadata for a dataset that is owned by the requesting user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_delete_dataset">Delete Dataset</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete a dataset that is owned by the requesting user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_offer_dataset_share">Offer Dataset Share</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Offer to share access to a dataset with a specific target user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_revoke_dataset_share">Revoke Dataset Share</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Revoke an existing share offer for a specific target dataset and user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_acceptreject_dataset_share_offer">Accept/Reject Dataset Share Offer</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accept or reject a dataset share offer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_list_share_offers">List Share Offers</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List shares offered to the requesting user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_reconciliation">Reconciliation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run the reconciliation process.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_failed_install_cleanup">Failed Install Cleanup</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run the failed install cleanup process.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_deleted_dataset_cleanup">Deleted Dataset Cleanup</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hard delete datasets that were soft deleted more than 24 hours prior.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_list_available_datasets">List Available Datasets</h4>
<div class="paragraph">
<p><a href="https://veupathdb.github.io/service-user-datasets/vdi-api.html#resources:/vdi-datasets:get">API Docs</a></p>
</div>
<div class="sect4">
<h5 id="_process_flow">Process Flow</h5>
<div class="imageblock text-center">
<div class="content">
<img src="assets/list-uds.png" alt="list uds">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_upload_dataset">Upload Dataset</h4>
<div class="paragraph">
<p><a href="https://veupathdb.github.io/service-user-datasets/vdi-api.html#resources:/vdi-datasets:post">API Docs</a></p>
</div>
<div class="sect4">
<h5 id="_process_flow_2">Process Flow</h5>
<div class="imageblock text-center">
<div class="content">
<img src="assets/upload-ud.png" alt="upload ud">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lookup_dataset">Lookup Dataset</h4>
<div class="paragraph">
<p><a href="https://veupathdb.github.io/service-user-datasets/vdi-api.html#resources:/vdi-datasets/{vd-id}:get">API Docs</a></p>
</div>
<div class="sect4">
<h5 id="_process_flow_3">Process Flow</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client makes a <code>GET</code> request for the target user dataset</p>
</li>
<li>
<p>Service validates the requesting user.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the request user is invalid, return <code>401</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Service queries postgres for information about the target dataset</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the dataset doesn&#8217;t exist, return <code>404</code></p>
</li>
<li>
<p>If the dataset isn&#8217;t visible to the target user, return <code>403</code></p>
</li>
<li>
<p>if the dataset has been soft deleted, return <code>404</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Service queries application databases for installation status of dataset</p>
</li>
<li>
<p>Service returns information about the target dataset</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_dataset_metadata">Update Dataset Metadata</h4>
<div class="paragraph">
<p><a href="https://veupathdb.github.io/service-user-datasets/vdi-api.html#resources:/vdi-datasets/{vd-id}:patch">API Docs</a></p>
</div>
<div class="sect4">
<h5 id="_process_flow_4">Process Flow</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client makes a <code>PATCH</code> request to the user dataset containing the meta fields
that should be updated.</p>
</li>
<li>
<p>Service validates requesting user.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the request user is invalid, return <code>401</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Service validates request body</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the data in the meta fields is of the wrong type, return <code>400</code></p>
</li>
<li>
<p>If the data in the meta fields is otherwise invalid, return <code>422</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Service queries postgres for information about the target dataset</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the target dataset does not exist, return <code>404</code></p>
</li>
<li>
<p>If the target dataset has been soft deleted, return <code>404</code></p>
</li>
<li>
<p>If the dataset is not owned by the requesting user, return</p>
</li>
</ol>
</div>
</li>
<li>
<p>Service downloads the old meta JSON for the dataset from the <a href="#_dataset_store">Dataset Store</a></p>
</li>
<li>
<p>Service generates a new meta JSON blob for the dataset</p>
</li>
<li>
<p>Service posts the new meta JSON blob to the <a href="#_dataset_store">Dataset Store</a></p>
</li>
<li>
<p>Service returns a <code>204</code> to the client.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delete_dataset">Delete Dataset</h4>
<div class="paragraph">
<p><a href="https://veupathdb.github.io/service-user-datasets/vdi-api.html#resources:/vdi-datasets/{vd-id}:delete">API Docs</a></p>
</div>
<div class="sect4">
<h5 id="_process_flow_5">Process Flow</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client makes a <code>DELETE</code> request to the service for a target dataset.</p>
</li>
<li>
<p>Service queries postgres for information about the target dataset.</p>
</li>
<li>
<p>Service verifies the requesting user owns the target dataset.</p>
</li>
<li>
<p>Service checks the <a href="#_dataset_store">Dataset Store</a> to ensure the dataset hasn&#8217;t been soft
deleted already.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Shortcut to <code>204</code> if it has.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Service creates a soft-delete marker object in the <a href="#_dataset_store">Dataset Store</a> for the
dataset.</p>
</li>
<li>
<p>Service returns a <code>204</code> to the client.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_offer_dataset_share">Offer Dataset Share</h4>
<div class="paragraph">
<p><a href="https://veupathdb.github.io/service-user-datasets/vdi-api.html#resources:/vdi-datasets/{vd-id}/shares/{recipient-user-id}/offer:put">API Docs</a></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Share offers are automatically accepted on behalf of the recipient by the
service.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The service sends out an email notification to the recipient notifying them of
the share offer.</p>
</div>
<div class="paragraph">
<p>This means that the service will need to be connected to an SMTP server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_q_a">Q &amp; A</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">What happens when a user attempts to share a dataset that failed import or
   installation?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If the dataset failed import then it cannot be shared as the share action
   impacts the App DB, and a non-imported dataset will not have any records in
   the App DB.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">What about if it failed installation on some but not all of the target sites?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>We want the share to work regardless of install status, the share won&#8217;t
   precipitate down to the App DBs if the installation of the dataset into those
   App DBs has failed.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_process_flow_6">Process Flow</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client makes a <code>PUT</code> request to the service with a payload containing a share
offer action of <code>grant</code>.</p>
</li>
<li>
<p>Service validates the requesting user.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the requesting user is invalid, return <code>401</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Service looks up details about the target dataset in the Postgres DB</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the target dataset does not exist, return <code>404</code></p>
</li>
<li>
<p>If the target dataset failed import, return <code>403</code></p>
</li>
<li>
<p>If the target dataset has been soft-deleted, return <code>403</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Service (re)places the dataset share offer in the <a href="#_dataset_store">Dataset Store</a>.</p>
</li>
<li>
<p>Service returns <code>204</code> to the client.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_revoke_dataset_share">Revoke Dataset Share</h4>
<div class="paragraph">
<p><a href="https://veupathdb.github.io/service-user-datasets/vdi-api.html#resources:/vdi-datasets/{vd-id}/shares/{recipient-user-id}/offer:put">API Docs</a></p>
</div>
<div class="sect4">
<h5 id="_process_flow_7">Process Flow</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client makes a <code>PUT</code> request to the service with a payload containing a share
offer action of <code>revoke</code>.</p>
</li>
<li>
<p>Service validates the requesting user.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the requesting user is invalid, return <code>401</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Service looks up details about the target dataset in the Postgres DB</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the target dataset does not exist, return a <code>404</code></p>
</li>
<li>
<p>If the target dataset has failed import, return <code>403</code></p>
</li>
<li>
<p>If the target dataset has been soft-deleted, return <code>403</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Service (re)places the dataset share offer in the <a href="#_dataset_store">Dataset Store</a></p>
</li>
<li>
<p>Service returns <code>204</code> to the client.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_acceptreject_dataset_share_offer">Accept/Reject Dataset Share Offer</h4>
<div class="paragraph">
<p><a href="https://veupathdb.github.io/service-user-datasets/vdi-api.html#resources:/vdi-datasets/{vd-id}/shares/{user-id}/receipt:put">API Docs</a></p>
</div>
<div class="sect4">
<h5 id="_process_flow_8">Process Flow</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client makes a <code>PUT</code> request to the service with a payload containing a share
receipt action of <code>accept</code> or <code>reject</code>.</p>
</li>
<li>
<p>Service validates the requesting user.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the requesting user is invalid, return <code>401</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Service looks up the target dataset in the postgres database.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the target dataset does not exist, return <code>404</code></p>
</li>
<li>
<p>If the target dataset has been soft deleted, return <code>404</code></p>
</li>
<li>
<p>If the target dataset has no open share offer for the requesting user, return <code>403</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>If the receipt action is <code>accept</code>
..</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_list_share_offers">List Share Offers</h4>
<div class="paragraph">
<p><a href="https://veupathdb.github.io/service-user-datasets/vdi-api.html#resources:/vdi-datasets/share-offers:get">API Docs</a></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<strong>TODO</strong>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_reconciliation">Reconciliation</h4>
<div class="paragraph">
<p><a href="https://veupathdb.github.io/service-user-datasets/vdi-api.html#resources:/vdi-datasets/admin/reconcile:post">API Docs</a></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<strong>TODO</strong>
</td>
</tr>
</table>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>We need reconciliation to cover the (rare) case where messages get lost.  This
can happen if minio is up (and emitting messages) but rabbit is down so does not
receive them, or… for unforeseen reasons.</p>
</div>
<div class="paragraph">
<p>The service has an admin/reconciliation endpoint,  protected by admin auth.</p>
</div>
<div class="paragraph">
<p>This endpoint is automatically activated on service start up.  (Caution:
consider race conditions with the other campus).  It can also be invoked
manually by an Ops person.  It is also scheduled nightly for production
services.</p>
</div>
<div class="paragraph">
<p>The process is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the reconciliation is triggered, one way or another</p>
</li>
<li>
<p>The service first reconciles the internal Postgres database.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The reconciler gets a listing of all files in S3, including last-modified timestamps</p>
</li>
<li>
<p>The reconciler iterates across those files, comparing timestamps to those in the internal DB</p>
</li>
<li>
<p>The reconciler synchronizes files that are out of date</p>
</li>
</ol>
</div>
</li>
<li>
<p>After the postgres reconciliation is complete, we determine which UDs are out of sync with target appdbs.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Query MinIO to get a list of all user datasets</p>
</li>
<li>
<p>Query Postgres to determine which projects datasets are targeted for</p>
</li>
<li>
<p>Use that list of projects to segment the complete list of UDs into per-project lists</p>
</li>
<li>
<p>For each list, compare timestamps between minio and appdb, using a bulk operation</p>
</li>
<li>
<p>For each UD (if any) that are out of date, invoke the standard UD appDB synchronizer</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</blockquote>
</div>
<div class="sect4">
<h5 id="_q_a_2">Q &amp; A</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">What happens if an exception occurs when iterating through the datasets in
   the Dataset Store and processing them in Postgres?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>???</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">What happens if an exception occurs when iterating through the datasets in
   the Dataset Store and processing them in the App DBs?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>???</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_process_flow_9">Process Flow</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client makes a <code>POST</code> request to the admin/reconciliation endpoint.</p>
</li>
<li>
<p>Service verifies the auth token in the request.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the request contains no auth token, return <code>401</code></p>
</li>
<li>
<p>If the request contains an invalid auth token, return <code>401</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Service gets a stream over the contents of the <a href="#_dataset_store">Dataset Store</a></p>
</li>
<li>
<p>Service groups the Dataset Store content stream into bundles of individual
dataset contents</p>
</li>
<li>
<p>Service iterates through the stream of dataset bundles and:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Compares the timestamps of the bundle files to the timestamps recorded in the
PostgresDB</p>
</li>
<li>
<p>Synchronizes files that are out of date (<strong>TODO</strong> define "synchronizes")</p>
</li>
</ol>
</div>
</li>
<li>
<p>???</p>
</li>
<li>
<p>???</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_failed_install_cleanup">Failed Install Cleanup</h4>
<div class="paragraph">
<p><a href="https://veupathdb.github.io/service-user-datasets/vdi-api.html#resources:/vdi-datasets/admin/install-cleanup:post">API Docs</a></p>
</div>
<div class="paragraph">
<p>There are two branches to this endpoint, the "all" branch and the "targets"
branch.  The "all" branch must go through and find all the failed dataset
installs to process, while the "target" branch must validate that all the given
dataset IDs have a broken install.</p>
</div>
<div class="sect4">
<h5 id="_process_flow_10">Process Flow</h5>
<div class="sect5">
<h6 id="_all_branch">All Branch</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client makes a <code>POST</code> request to the admin/install-cleanup endpoint</p>
</li>
<li>
<p>Service verifies the auth token in the request</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the request contains no auth token, return <code>401</code></p>
</li>
<li>
<p>If the request contains an invalid auth token, return <code>401</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Service gets a list of all failed dataset installs (<strong>TODO</strong>: Define how this is done)</p>
</li>
<li>
<p>Service marks all the failed dataset installs with the <code>ready-for-reinstall</code> status</p>
</li>
<li>
<p>Service returns <code>204</code> to the client.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_targets_branch">Targets Branch</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client makes a <code>POST</code> request to the admin/install-cleanup endpoint</p>
</li>
<li>
<p>Service verifies the auth token in the request</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the request contains no auth token, return <code>401</code></p>
</li>
<li>
<p>If the request contains an invalid auth token, return <code>401</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Service iterates through the given list of failed dataset IDs and</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Service looks up the target failed dataset ID in the Postgres DB</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>If the target dataset does not exist, skip to the next dataset ID</p>
</li>
</ol>
</div>
</li>
<li>
<p>Service iterates through the list of relevant App DBs to find installation
failures</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>When a failure is found, service marks the dataset with the
<code>ready-for-reinstall</code> status.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Service returns <code>204</code> to the client.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deleted_dataset_cleanup">Deleted Dataset Cleanup</h4>
<div class="paragraph">
<p><a href="https://veupathdb.github.io/service-user-datasets/vdi-api.html#resources:/vdi-datasets/admin/delete-cleanup:post">API Docs</a></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<strong>TODO</strong>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_internal_actions">Internal Actions</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Action</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_import_dataset">Import Dataset</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_import_queue">Import Queue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validate and transform an uploaded dataset in preparation for installation
into the target site(s) database(s).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_sort_dataset_store_change">Sort Dataset Store Change</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_dataset_store_queue">Dataset Store Queue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Handle a change notification from the Dataset Store, sort/transform the notice
into a dataset change action and publish that action message to the <a href="#Action
Queue">[Action
Queue]</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_dataset_installation">Dataset Installation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_action_queue">Action Queue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">???</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_dataset_soft_delete">Dataset Soft Delete</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_action_queue">Action Queue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TODO: what happens downstream of S3 after a soft delete?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_dataset_hard_delete">Dataset Hard Delete</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_action_queue">Action Queue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TODO: what happens downstream of S3 after a hard delete?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Dataset Meta Change">[Dataset Meta Change]</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_action_queue">Action Queue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TODO: what happens downstream of S3 after a metadata change?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Dataset Shares Change">[Dataset Shares Change]</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_action_queue">Action Queue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TODO: what does this look like?  Are there separate actions for shares being granted/revoked/accepted/rejected?</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_import_dataset">Import Dataset</h4>
<div class="sect4">
<h5 id="_process_flow_11">Process Flow</h5>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>TODO</strong>: the flowchart below is outdated and needs to be replaced.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/process-import.png" alt="process import">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sort_dataset_store_change">Sort Dataset Store Change</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<strong>TODO</strong>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dataset_installation">Dataset Installation</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<strong>TODO</strong>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dataset_soft_delete">Dataset Soft Delete</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<strong>TODO</strong>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dataset_hard_delete">Dataset Hard Delete</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<strong>TODO</strong>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_old_actions">[OLD] Actions</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This section is being split into the 2 sections above: <a href="#_api_actions">API Actions</a> and
<a href="#_internal_actions">Internal Actions</a></p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 10%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Action</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_process_user_dataset_store_change">Process User Dataset Store Change</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RabbitMQ &lt;2&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process a change in the User Dataset Store that has been published to
  RabbitMQ.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project Sync</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RabbitMQ &lt;3&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">???</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_process_user_dataset_store_change">Process User Dataset Store Change</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Determine the nature of the change ???</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>What are the possible changes that could happen?</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>marked as deleted</p>
</li>
<li>
<p>actually deleted?</p>
</li>
<li>
<p>share granted</p>
</li>
<li>
<p>share accepted</p>
</li>
<li>
<p>share rejected</p>
</li>
<li>
<p>share revoked</p>
</li>
<li>
<p>initial upload</p>
</li>
<li>
<p>meta changed</p>
</li>
</ol>
</div>
</li>
<li>
<p>Compare the last modified timestamps in S3 to the timestamps in the postgres
<code>sync_control</code> table.</p>
</li>
</ol>
</div>
</li>
<li>
<p>???</p>
</li>
<li>
<p>Update postgres?</p>
</li>
<li>
<p>Queue changes to relevant application databases?</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_import_handler_service">Import Handler Service</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_actions">Actions</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Action</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_process_import">Process Import</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Performs import validation/transformations on an uploaded dataset to prepare
  it for import and eventual installation into one or more VEuPathDB sites.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_process_import">Process Import</h4>
<div class="paragraph">
<p>Performs import validation/transformations on an uploaded dataset to prepare it
for import and eventual installation into one or more VEuPathDB sites.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">What is the contract for data being placed in the inputs directory?<br>
   Should the meta file always have the same name?<br>
   How are files differentiated?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>meta.json</code> file and <code>dataset.json</code> files are generated by the service and
  will not be provided to the handler script, thus the handler script does not
  need to know about them and no special contract is needed.<br>
<br>
  This means the contract is simply that some files will be put in the inputs
  directory and the script can figure out what they are and what they mean.</p></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create workspace directory for the import being processed</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create "input" subdirectory</p>
</li>
<li>
<p>Create "output" subdirectory</p>
</li>
</ol>
</div>
</li>
<li>
<p>Push the files uploaded for the dataset to the "input" subdirectory of the
import workspace</p>
</li>
<li>
<p>Call the import script, passing in the paths to the input and output
directories</p>
</li>
<li>
<p>Generate a <code>manifest.json</code> file</p>
</li>
<li>
<p>Generate a <code>meta.json</code> file</p>
</li>
<li>
<p>Bundle the files placed in the output directory</p>
</li>
<li>
<p>Return the bundled archive to the HTTP caller</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_general_q_a">General Q &amp; A</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Who generates the <code>manifest.json</code> file?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The <code>manifest.json</code> file will be simplified.  Instead of attempting to keep
a mapping of input file name to output file name, which is both restrictive and
forces the import script to generate the file, we will change the <code>"dataFiles"</code>
array to be an array of output file names instead of a mapping of input to
output file names.</p>
</div>
<div class="listingblock">
<div class="title">Original Design</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "dataFiles": [
    {
      "name": "some-file-name.txt",
      "path": "original-crazy-user-provided-name.txt"
    },
    {
      "name": "some-other-file.tsv",
      "path": "original-other-file-name.txt"
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">New Design</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "dataFiles": [
    "some-file-name.txt",
    "some-other-file.tsv"
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If necessary, the input file names can be maintained as a separate array which
would give us the information without implicitly enforcing any rules on input to
output mapping.</p>
</div>
<div class="listingblock">
<div class="title">Optional Input Names</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "inputFiles": [
    "foo-bar-fizz.txt",
    "my-dog-dexter.jpg",
    "my-grandmas-famous-apple-pie-recipe.pdf"
  ],
  "dataFiles": [
    "some-output.biom",
    "some-other-output.tsv"
  ]
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">How is the user quota measured and managed?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>???</p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">What if the communication between the service and the import plugin was
   handled via a RabbitMQ queue?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">This adds a lot of complexity to the design.  If we had a stream management
  platform such as Apache Spark or Kafka, this would be more feasible, but
  without such a platform it would be difficult to test and maintain.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Why not write the whole thing as a stream system in Spark or Kafka?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">How do we hide endpoints from the public API?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">We don&#8217;t.  The endpoints will be publicly available, but will be secured with
an API token</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">How are the statuses displayed to the client/user? We have multiple status
   types; it could be confusing.</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The statuses will be returned in a "status object" as described in the misc
  notes below.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Installers: What are the inputs and outputs?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Installers will have their data posted to them the same as with the import
handler.  A bulk HTTP request containing the dataset files and metadata will be
submitted to the Installer Service and the installer will take it from there.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Why is it a 2 request process to create a user dataset upload?<br>
Originally, the 2-step process was because we needed to guarantee ordering of
receipt of the metadata followed by dataset files, but since the data is going
to a cache/queue before being processed, does this matter anymore?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">We can ditch the 2-step process.  Now that we have
<a href="https://github.com/VEuPathDB/lib-jersey-multipart-jackson-pojo">lib-jersey-multipart-jackson-pojo</a>
we don&#8217;t need to separate the meta upload from the file uploads as all the
uploaded data will be preloaded into files for us automatically.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">What does the dataset delete flow look like?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="olist arabic">
<ol class="arabic">
<li>
<p>Deletion flag is created</p>
</li>
<li>
<p>After 24 hours the dataset is subject to deletion by the
<a href="#cleanup-deleted-datasets">[cleanup-deleted-datasets]</a> endpoint</p>
</li>
</ol>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">How are full deletes handled?  We make a soft delete flag but what happens
   after that and who takes care of it?</p></th>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">How do installers surface warnings?<br>
   How do failed installations get reported to users?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">STDOUT log output from the process is gathered and posted to S3.  If the
  installation succeeded, then these messages are considered warnings.  If the
  installation failed, then the last of these messages is considered an error.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">How does undeleting work?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Are the handler servers per type &amp; database or just per type?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Just per type, each handler will connect to multiple databases.</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">How are the credentials passed to the handler server?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A mounted JSON configuration file that will contain the credentials in a
mapping of objects keyed on the target Project ID.<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "credentials": {
    "PlasmoDB": {

    }
  }
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_general_implementation_notes_thoughts">General Implementation Notes / Thoughts</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Service will have to check the soft delete flag before permitting any actions
on a user dataset.</p>
</li>
<li>
<p>The service wrapping the installer and import handler should be written in
a JVM language to make use of the existing tooling for handling multipart that
we have established.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_unorganized_notes">Unorganized Notes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_submitting_a_user_dataset">Submitting a User Dataset</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client sends "prep" request with metadata about the dataset to be
uploaded.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Service sanity checks the posted metadata to ensure that it at least <em>could
be</em> valid.</p>
</li>
<li>
<p>Service puts the metadata into an in-memory cache with a short, configurable
expiration</p>
</li>
<li>
<p>Service generates a user dataset ID</p>
</li>
<li>
<p>Service returns a user dataset ID</p>
</li>
</ol>
</div>
</li>
<li>
<p>Client sends an upload request with the file or files comprising the user
dataset.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Service pulls the metadata for the user dataset out of the in-memory cache.</p>
</li>
<li>
<p>Service submits the metadata and the uploaded files to an internal job queue.</p>
</li>
<li>
<p>Service returns a status indicating whether the import process has been
started</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_internal_processing_an_import">[Internal] Processing an Import</h3>
<div class="paragraph">
<p>When a worker thread becomes available to process an import, it will be pulled
from the queue and the following will be executed.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Worker submits the metadata for the job to be processed to the import handler
plugin.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Import handler does whatever it needs to do to prepare for processing a user
dataset.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Worker submits the files for the dataset to the import handler.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Import handler processes user dataset and produces a gzip bundle of the
dataset state to be uploaded to the Dataset Store</p>
</li>
</ol>
</div>
</li>
<li>
<p>Worker unpacks dataset bundle</p>
</li>
<li>
<p>Worker uploads dataset files to the Dataset Store</p>
</li>
<li>
<p>Worker updates the status of the dataset to "imported" or similar</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_misc_notes">Misc Notes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Notes and thoughts to be folded into the design doc above once resolved.</p>
</div>
<div class="sect2">
<h3 id="_statuses">Statuses</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">What different statuses are there?</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Upload status</p>
</li>
<li>
<p><code>userdataset</code> table status (appears to also be upload status?)</p>
</li>
<li>
<p>Install status (per project) (this field will be omitted or empty until the
import is completed successfully)</p>
<div class="listingblock">
<div class="title">Status representation idea?</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "statuses": {
    "import": "complete",
    "install": [
      {
        "projectID": "PlasmoDB",
        "status": "complete"
      }
    ]
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_shares">Shares</h3>
<div class="paragraph">
<p>Sharing datasets is done as a 2 part process, a source user offers to share a
dataset with a target user, and the target user has to accept the share offer.</p>
</div>
<div class="paragraph">
<p>Both these pieces must exist for a share to be valid, an active offer, and
active receipt, if either side is rejected or deleted then the share is
invalidated.</p>
</div>
<div class="paragraph">
<p>In the <a href="#_dataset_store">Dataset Store</a> a share is represented by 2 empty objects, an offer
object and a receipt object.  These objects are keyed on both the dataset ID and
the target user ID.</p>
</div>
</div>
<div class="sect2">
<h3 id="_misc_diagrams">Misc Diagrams</h3>
<div class="paragraph">
<div class="title">User Dataset Import Components</div>
<p><span class="image"><img src="assets/ds-import-components.png" alt="ds import components"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_database_schemata">Database Schemata</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_internal_postgresql_database">Internal PostgreSQL Database</h3>
<div class="paragraph">
<p>Tables here cannot be the single source of truth for information about the
datasets.  While this database should not be wiped, it needs to be constructable
from the state of the Dataset Store.</p>
</div>
<div class="sect3">
<h4 id="_vdi_datasets"><code>vdi.datasets</code></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataset_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR(32)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type_version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIGINT</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is_deleted</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BOOLEAN</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">???</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>What is the <code>status</code> field?</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_vdi_dataset_metadata"><code>vdi.dataset_metadata</code></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataset_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR(32)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>summary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_vdi_sync_control"><code>vdi.sync_control</code></h4>
<div class="paragraph">
<p>This table indicates the last modified timestamp for the various components that
comprise a user dataset.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataset_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR(32)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shares_update_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIMESTAMPTZ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp of the most recent last_modified date from the user dataset share
  files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>data_update_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIMESTAMPTZ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp of the most recent last_modified date from the user dataset data
  files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>meta_update_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIMESTAMPTZ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp of the meta.json last_modified date for the user dataset.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_vdi_owner_share"><code>vdi.owner_share</code></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataset_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR(32)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shared_with</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIGINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User ID of the user the dataset was shared with</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enum</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current status of the share<br>
One of "grant" | "revoke"</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_vdi_recipient_share"><code>vdi.recipient_share</code></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataset_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR(32)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shared_with</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIGINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User ID of the user the dataset was shared with</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enum</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current status of the share receipt.<br>
One of "accept" | "reject"</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_vdi_dataset_control"><code>vdi.dataset_control</code></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataset_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR(32)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>upload_status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enum</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"awaiting-import", "importing", "imported", "failed"</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_vdi_dataset_files"><code>vdi.dataset_files</code></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataset_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR(32)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>file_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_vdi_dataset_projects"><code>vdi.dataset_projects</code></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataset_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR(32)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>project_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_application_database">Application Database</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">What schema will these tables live in?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">???</p></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_user_datasets"><code>user_datasets</code></h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">What date gets stored in the <code>creation_time</code> column?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">???</p></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataset_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR(32)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>owner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIGINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Owner user ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dataset type string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dataset type version string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>creation_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIMESTAMP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">???</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>is_deleted</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TINYINT(1)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Soft delete flag.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_user_dataset_install_messages"><code>user_dataset_install_messages</code></h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">What is a message_id?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">???</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">What is an install type?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">???</p></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataset_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR(32)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreign key to <code>user_datasets.dataset_id</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>message_id</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">???</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>install_type</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">???</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enum</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"running", "complete", "failed", "ready-for-reinstall"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>message</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">failure message?</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_user_dataset_visibility"><code>user_dataset_visibility</code></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataset_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR(32)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreign key to <code>user_datasets.dataset_id</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIGINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the share recipient user who should be able to see the user dataset.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_user_dataset_projects"><code>user_dataset_projects</code></h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">What is the purpose of this table being in the application database?  Does an
   application care about what <em>other</em> sites a dataset is installed in?  Should
   the VDI service be the only point of truth for this?</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">???</p></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataset_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR(32)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreign key to <code>user_datasets.dataset_id</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>project_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name/ID of the target site for the user dataset.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-02-16 10:55:08 -0500
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>