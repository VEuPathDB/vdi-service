version: "3.5"
networks:
  internal:
  traefik:
    external: true
  monitoring-ext:
    external: false
  rabbitmq:
    external: false
volumes:
  cache-db-data:
services:
  plugin-rnaseq:
    image: veupathdb/vdi-plugin-rnaseq:1.4.1
    networks:
      internal:
        aliases:
          - rnaseq
      monitoring-ext: {}
    volumes:
      - type: bind
        source: /tmp
        target: /datasets
    environment:
      LDAP_SERVER: ds1.apidb.org:389,ds4.apidb.org:389
      ORACLE_BASE_DN: ou=applications,dc=apidb,dc=org
      CUSTOM_PATH: ''
      SITE_BUILD: build-65
      DATASET_INSTALL_ROOT: /datasets
      IMPORT_SCRIPT_MAX_DURATION: ''
      INSTALL_DATA_SCRIPT_MAX_DURATION: ''
      INSTALL_META_SCRIPT_MAX_DURATION: ''
      UNINSTALL_SCRIPT_MAX_DURATION: ''
      CHECK_COMPAT_SCRIPT_MAX_DURATION: ''
      DB_CONNECTION_ENABLED_AMOEBA: false
      DB_CONNECTION_NAME_AMOEBA: AmoebaDB
      DB_CONNECTION_LDAP_AMOEBA: ameb-inc
      DB_CONNECTION_PASS_AMOEBA: blad4nd3r
      DB_CONNECTION_DATA_SCHEMA_AMOEBA: vdi_datasets_dev_n
      DB_CONNECTION_CONTROL_SCHEMA_AMOEBA: vdi_control_dev_n
      DB_CONNECTION_POOL_SIZE_AMOEBA: ''
    depends_on:
      - tunnel_ares13_penn_apidb_org_1521
      - tunnel_ares8_penn_apidb_org_1521
      - tunnel_ares9_penn_apidb_org_1521
      - tunnel_ds1_apidb_org_389
      - tunnel_ares6_penn_apidb_org_1521
      - tunnel_ares10_penn_apidb_org_1521
      - tunnel_ares11_penn_apidb_org_1521
      - tunnel_ds4_apidb_org_389
      - tunnel_ares14_penn_apidb_org_1521
  rabbit-external:
    image: rabbitmq:3.11.13-management-alpine
    ports:
      - "5672:5672"
      - "9002:15672"
    networks:
      - rabbitmq
    environment:
      RABBITMQ_DEFAULT_USER: someUser
      RABBITMQ_DEFAULT_PASS: somePassword
    healthcheck:
      test: [CMD, curl, -f, 'http://localhost:15672']
      interval: 30s
      timeout: 10s
      retries: 5
  tunnel_ds1_apidb_org_389:
    image: kroniak/ssh-client:3.19
    entrypoint:
      - ssh
      - -tNn
      - -p
      - 2112
      - -o
      - ServerAliveInterval=60
      - -L
      - ds1.apidb.org:389:ds1.apidb.org:389
      - epharper@fir.penn.apidb.org
    environment:
      SSH_AUTH_SOCK: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
    volumes:
      - type: bind
        source: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
        target: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
      - type: bind
        source: /home/ellie/.ssh/known_hosts
        target: /root/.ssh/known_hosts
    networks:
      internal:
        aliases:
          - ds1.apidb.org
  tunnel_minio_dev_penn_apidb_org_9000:
    image: kroniak/ssh-client:3.19
    entrypoint:
      - ssh
      - -tNn
      - -p
      - 2112
      - -o
      - ServerAliveInterval=60
      - -L
      - minio-dev.penn.apidb.org:9000:minio-dev.penn.apidb.org:9000
      - epharper@fir.penn.apidb.org
    environment:
      SSH_AUTH_SOCK: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
    volumes:
      - type: bind
        source: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
        target: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
      - type: bind
        source: /home/ellie/.ssh/known_hosts
        target: /root/.ssh/known_hosts
    networks:
      internal:
        aliases:
          - minio-dev.penn.apidb.org
  service:
    links:
      - plugin-bigwig
      - plugin-biom
      - plugin-example
      - plugin-genelist
      - plugin-isasimple
      - rabbit-external
      - cache-db
      - kafka
      - minio-external
      - plugin-rnaseq
    stop_grace_period: 1m
    build:
      context: .
    depends_on:
      - tunnel_ares9_penn_apidb_org_1521
      - tunnel_ds1_apidb_org_389
      - kafka
      - plugin-biom
      - tunnel_ares8_penn_apidb_org_1521
      - plugin-rnaseq
      - tunnel_ares14_penn_apidb_org_1521
      - plugin-genelist
      - tunnel_minio_dev_penn_apidb_org_9000
      - plugin-example
      - minio-external
      - plugin-bigwig
      - minio-create-buckets
      - tunnel_ares13_penn_apidb_org_1521
      - tunnel_ares6_penn_apidb_org_1521
      - tunnel_ares10_penn_apidb_org_1521
      - tunnel_ares11_penn_apidb_org_1521
      - cache-db
      - rabbit-external
      - plugin-isasimple
      - tunnel_ds4_apidb_org_389
    labels:
      - "traefik.http.services.vdi-dev.loadbalancer.server.port=80"
      - "traefik.http.routers.vdi-dev.rule=Host(`vdi-dev.local.apidb.org`)"
      - "traefik.http.routers.vdi-dev.tls=true"
      - "traefik.http.routers.vdi-dev.entrypoints=local"
      - "traefik.docker.network=traefik"
    image: veupathdb/vdi-service:1.4.5
    ports:
      - "8080:80"
    networks:
      - rabbitmq
      - internal
      - traefik
      - monitoring-ext
    environment:
      # JVM Args
      JVM_MEM_ARGS: ''
      # Rest Service
      SERVER_PORT: 80
      AUTH_SECRET_KEY: c80394ded2f081dc8dfff4f03005aa86
      ADMIN_AUTH_TOKEN: someSecretKey
      ENABLE_CORS: true
      # LDAP Configuration
      LDAP_SERVER: ds1.apidb.org:389,ds4.apidb.org:389
      ORACLE_BASE_DN: ou=applications,dc=apidb,dc=org
      # OAuth Configuration
      OAUTH_URL: https://eupathdb.org/oauth
      OAUTH_CLIENT_ID: veupathdbService
      OAUTH_CLIENT_SECRET: SrUX8ypLgl1SeGByURPOr5/wZPVu7Agw/VAEI11sgXJTdPNEVGpEzjAlVU3abjkBD1zQa5ZbX/Aqcp
      # Upload Configuration
      MAX_UPLOAD_FILE_SIZE: ''
      USER_UPLOAD_QUOTA: ''
      # Hard Delete Handler
      HARD_DELETE_HANDLER_KAFKA_CONSUMER_CLIENT_ID: ''
      HARD_DELETE_HANDLER_WORKER_POOL_SIZE: ''
      HARD_DELETE_HANDLER_WORK_QUEUE_SIZE: ''
      # Import Handler
      IMPORT_HANDLER_KAFKA_CONSUMER_CLIENT_ID: ''
      IMPORT_HANDLER_WORKER_POOL_SIZE: ''
      IMPORT_HANDLER_WORK_QUEUE_SIZE: ''
      # Install Data Handler
      INSTALL_DATA_HANDLER_KAFKA_CONSUMER_CLIENT_ID: ''
      INSTALL_DATA_HANDLER_WORKER_POOL_SIZE: ''
      INSTALL_DATA_HANDLER_WORK_QUEUE_SIZE: ''
      # Pruner
      DATASET_PRUNING_DELETION_THRESHOLD: 2m
      DATASET_PRUNING_INTERVAL: ''
      DATASET_PRUNING_WAKEUP_INTERVAL: ''
      # Share Handler
      SHARE_HANDLER_KAFKA_CONSUMER_CLIENT_ID: ''
      SHARE_HANDLER_WORKER_POOL_SIZE: ''
      SHARE_HANDLER_WORK_QUEUE_SIZE: ''
      # Soft Delete Handler
      SOFT_DELETE_HANDLER_KAFKA_CONSUMER_CLIENT_ID: ''
      SOFT_DELETE_HANDLER_WORKER_POOL_SIZE: ''
      SOFT_DELETE_HANDLER_WORK_QUEUE_SIZE: ''
      # Update Meta Handler
      UPDATE_META_HANDLER_KAFKA_CONSUMER_CLIENT_ID: ''
      UPDATE_META_HANDLER_WORKER_POOL_SIZE: ''
      UPDATE_META_HANDLER_WORK_QUEUE_SIZE: ''
      # Reconciliation Handler
      RECONCILIATION_HANDLER_KAFKA_CONSUMER_CLIENT_ID: ''
      RECONCILIATION_HANDLER_WORKER_POOL_SIZE: ''
      RECONCILIATION_HANDLER_WORK_QUEUE_SIZE: ''
      # Cache DB
      CACHE_DB_USERNAME: someUser
      CACHE_DB_PASSWORD: somePassword
      CACHE_DB_NAME: vdi
      CACHE_DB_HOST: cache-db
      CACHE_DB_PORT: ''
      CACHE_DB_POOL_SIZE: ''
      # Kafka
      KAFKA_SERVERS: kafka:9092
      KAFKA_CONSUMER_GROUP_ID: vdi-kafka-consumers
      KAFKA_PRODUCER_CLIENT_ID: vdi-event-router
      KAFKA_TOPIC_HARD_DELETE_TRIGGERS: ''
      KAFKA_TOPIC_IMPORT_TRIGGERS: ''
      KAFKA_TOPIC_INSTALL_TRIGGERS: ''
      KAFKA_TOPIC_SHARE_TRIGGERS: ''
      KAFKA_TOPIC_SOFT_DELETE_TRIGGERS: ''
      KAFKA_TOPIC_UPDATE_META_TRIGGERS: ''
      KAFKA_TOPIC_RECONCILIATION_TRIGGERS: ''
      KAFKA_MESSAGE_KEY_HARD_DELETE_TRIGGERS: ''
      KAFKA_MESSAGE_KEY_IMPORT_TRIGGERS: ''
      KAFKA_MESSAGE_KEY_INSTALL_TRIGGERS: ''
      KAFKA_MESSAGE_KEY_SHARE_TRIGGERS: ''
      KAFKA_MESSAGE_KEY_SOFT_DELETE_TRIGGERS: ''
      KAFKA_MESSAGE_KEY_UPDATE_META_TRIGGERS: ''
      KAFKA_MESSAGE_KEY_RECONCILIATION_TRIGGERS: ''
      # RabbitMQ
      GLOBAL_RABBIT_HOST: rabbit-external
      GLOBAL_RABBIT_PORT: ''
      GLOBAL_RABBIT_USERNAME: someUser
      GLOBAL_RABBIT_PASSWORD: somePassword
      GLOBAL_RABBIT_USE_TLS: ''
      GLOBAL_RABBIT_CONNECTION_NAME: vdi
      GLOBAL_RABBIT_VDI_EXCHANGE_NAME: vdi-bucket-notifications
      GLOBAL_RABBIT_VDI_EXCHANGE_TYPE: ''
      GLOBAL_RABBIT_VDI_EXCHANGE_DURABLE: ''
      GLOBAL_RABBIT_VDI_QUEUE_NAME: vdi-bucket-notifications
      GLOBAL_RABBIT_VDI_QUEUE_DURABLE: ''
      GLOBAL_RABBIT_VDI_ROUTING_KEY: vdi-bucket-notifications
      GLOBAL_RABBIT_VDI_POLLING_INTERVAL: ''
      # MinIO
      S3_HOST: minio-external
      S3_PORT: 9000
      S3_USE_HTTPS: false
      S3_ACCESS_TOKEN: someToken
      S3_SECRET_KEY: someSecretKey
      S3_BUCKET_NAME: some-other-bucket
      # Reconciler
      RECONCILER_FULL_ENABLED: false
      RECONCILER_FULL_RUN_INTERVAL: ''
      RECONCILER_SLIM_RUN_INTERVAL: ''
      #
      # Wildcard Plugin Variables
      #

      # NoOp Plugin
      PLUGIN_HANDLER_NOOP_NAME: noop
      PLUGIN_HANDLER_NOOP_DISPLAY_NAME: "Example Plugin"
      PLUGIN_HANDLER_NOOP_VERSION: 1.0
      PLUGIN_HANDLER_NOOP_ADDRESS: example:80
      PLUGIN_HANDLER_NOOP_PROJECT_IDS: ''
      # Genelist Plugin
      PLUGIN_HANDLER_GENELIST_NAME: genelist
      PLUGIN_HANDLER_GENELIST_DISPLAY_NAME: "Gene List"
      PLUGIN_HANDLER_GENELIST_VERSION: 1.0
      PLUGIN_HANDLER_GENELIST_ADDRESS: genelist:80
      PLUGIN_HANDLER_GENELIST_PROJECT_IDS: AmoebaDB,CryptoDB,FungiDB,GiardiaDB,HostDB,MicrosporidiaDB,PiroplasmaDB,PlasmoDB,ToxoDB,TrichDB,TriTrypDB,VectorBase
      # ISASimple Plugin
      PLUGIN_HANDLER_ISASIMPLE_NAME: isasimple
      PLUGIN_HANDLER_ISASIMPLE_DISPLAY_NAME: "ISA Study"
      PLUGIN_HANDLER_ISASIMPLE_VERSION: 1.0
      PLUGIN_HANDLER_ISASIMPLE_ADDRESS: isasimple:80
      PLUGIN_HANDLER_ISASIMPLE_PROJECT_IDS: ClinEpiDB
      # BigWig Plugin
      PLUGIN_HANDLER_BIGWIG_NAME: bigwigfiles
      PLUGIN_HANDLER_BIGWIG_DISPLAY_NAME: Bigwig
      PLUGIN_HANDLER_BIGWIG_VERSION: 1.0
      PLUGIN_HANDLER_BIGWIG_ADDRESS: bigwig:80
      PLUGIN_HANDLER_BIGWIG_PROJECT_IDS: AmoebaDB,CryptoDB,FungiDB,GiardiaDB,HostDB,MicrosporidiaDB,PiroplasmaDB,PlasmoDB,ToxoDB,TrichDB,TriTrypDB,VectorBase
      # BIOM Plugin
      PLUGIN_HANDLER_BIOM_NAME: biom
      PLUGIN_HANDLER_BIOM_DISPLAY_NAME: BIOM
      PLUGIN_HANDLER_BIOM_VERSION: 1.0
      PLUGIN_HANDLER_BIOM_ADDRESS: biom:80
      PLUGIN_HANDLER_BIOM_PROJECT_IDS: MicrobiomeDB
      # RNAseq Plugin
      PLUGIN_HANDLER_RNASEQ_NAME: rnaseq
      PLUGIN_HANDLER_RNASEQ_DISPLAY_NAME: RNA-Seq
      PLUGIN_HANDLER_RNASEQ_VERSION: 1.0
      PLUGIN_HANDLER_RNASEQ_ADDRESS: rnaseq:80
      PLUGIN_HANDLER_RNASEQ_PROJECT_IDS: AmoebaDB,CryptoDB,FungiDB,GiardiaDB,HostDB,MicrosporidiaDB,PiroplasmaDB,PlasmoDB,ToxoDB,TrichDB,TriTrypDB,VectorBase
      #
      # Wildcard Database Variables
      #
      DB_CONNECTION_ENABLED_AMOEBA: false
      DB_CONNECTION_NAME_AMOEBA: AmoebaDB
      DB_CONNECTION_LDAP_AMOEBA: ameb-inc
      DB_CONNECTION_PASS_AMOEBA: blad4nd3r
      DB_CONNECTION_DATA_SCHEMA_AMOEBA: vdi_datasets_dev_n
      DB_CONNECTION_CONTROL_SCHEMA_AMOEBA: vdi_control_dev_n
      DB_CONNECTION_POOL_SIZE_AMOEBA: ''
  plugin-example:
    depends_on:
      - tunnel_ares13_penn_apidb_org_1521
      - tunnel_ares8_penn_apidb_org_1521
      - tunnel_ares9_penn_apidb_org_1521
      - tunnel_ds1_apidb_org_389
      - tunnel_ares6_penn_apidb_org_1521
      - tunnel_ares10_penn_apidb_org_1521
      - tunnel_ares11_penn_apidb_org_1521
      - tunnel_ds4_apidb_org_389
      - tunnel_ares14_penn_apidb_org_1521
    image: veupathdb/vdi-plugin-example:1.6.0
    networks:
      internal:
        aliases:
          - example
      monitoring-ext: {}
    volumes:
      - type: bind
        source: /tmp
        target: /datasets
    environment:
      LDAP_SERVER: ds1.apidb.org:389,ds4.apidb.org:389
      ORACLE_BASE_DN: ou=applications,dc=apidb,dc=org
      CUSTOM_PATH: ''
      SITE_BUILD: build-65
      DATASET_INSTALL_ROOT: /datasets
      IMPORT_SCRIPT_MAX_DURATION: ''
      INSTALL_DATA_SCRIPT_MAX_DURATION: ''
      INSTALL_META_SCRIPT_MAX_DURATION: ''
      UNINSTALL_SCRIPT_MAX_DURATION: ''
      CHECK_COMPAT_SCRIPT_MAX_DURATION: ''
      DB_CONNECTION_ENABLED_AMOEBA: false
      DB_CONNECTION_NAME_AMOEBA: AmoebaDB
      DB_CONNECTION_LDAP_AMOEBA: ameb-inc
      DB_CONNECTION_PASS_AMOEBA: blad4nd3r
      DB_CONNECTION_DATA_SCHEMA_AMOEBA: vdi_datasets_dev_n
      DB_CONNECTION_CONTROL_SCHEMA_AMOEBA: vdi_control_dev_n
      DB_CONNECTION_POOL_SIZE_AMOEBA: ''
  tunnel_ares6_penn_apidb_org_1521:
    image: kroniak/ssh-client:3.19
    entrypoint:
      - ssh
      - -tNn
      - -p
      - 2112
      - -o
      - ServerAliveInterval=60
      - -L
      - ares6.penn.apidb.org:1521:ares6.penn.apidb.org:1521
      - epharper@fir.penn.apidb.org
    environment:
      SSH_AUTH_SOCK: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
    volumes:
      - type: bind
        source: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
        target: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
      - type: bind
        source: /home/ellie/.ssh/known_hosts
        target: /root/.ssh/known_hosts
    networks:
      internal:
        aliases:
          - ares6.penn.apidb.org
  tunnel_ares10_penn_apidb_org_1521:
    image: kroniak/ssh-client:3.19
    entrypoint:
      - ssh
      - -tNn
      - -p
      - 2112
      - -o
      - ServerAliveInterval=60
      - -L
      - ares10.penn.apidb.org:1521:ares10.penn.apidb.org:1521
      - epharper@fir.penn.apidb.org
    environment:
      SSH_AUTH_SOCK: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
    volumes:
      - type: bind
        source: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
        target: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
      - type: bind
        source: /home/ellie/.ssh/known_hosts
        target: /root/.ssh/known_hosts
    networks:
      internal:
        aliases:
          - ares10.penn.apidb.org
  tunnel_ares14_penn_apidb_org_1521:
    image: kroniak/ssh-client:3.19
    entrypoint:
      - ssh
      - -tNn
      - -p
      - 2112
      - -o
      - ServerAliveInterval=60
      - -L
      - ares14.penn.apidb.org:1521:ares14.penn.apidb.org:1521
      - epharper@fir.penn.apidb.org
    environment:
      SSH_AUTH_SOCK: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
    volumes:
      - type: bind
        source: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
        target: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
      - type: bind
        source: /home/ellie/.ssh/known_hosts
        target: /root/.ssh/known_hosts
    networks:
      internal:
        aliases:
          - ares14.penn.apidb.org
  tunnel_ares11_penn_apidb_org_1521:
    image: kroniak/ssh-client:3.19
    entrypoint:
      - ssh
      - -tNn
      - -p
      - 2112
      - -o
      - ServerAliveInterval=60
      - -L
      - ares11.penn.apidb.org:1521:ares11.penn.apidb.org:1521
      - epharper@fir.penn.apidb.org
    environment:
      SSH_AUTH_SOCK: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
    volumes:
      - type: bind
        source: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
        target: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
      - type: bind
        source: /home/ellie/.ssh/known_hosts
        target: /root/.ssh/known_hosts
    networks:
      internal:
        aliases:
          - ares11.penn.apidb.org
  tunnel_ds4_apidb_org_389:
    image: kroniak/ssh-client:3.19
    entrypoint:
      - ssh
      - -tNn
      - -p
      - 2112
      - -o
      - ServerAliveInterval=60
      - -L
      - ds4.apidb.org:389:ds4.apidb.org:389
      - epharper@fir.penn.apidb.org
    environment:
      SSH_AUTH_SOCK: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
    volumes:
      - type: bind
        source: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
        target: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
      - type: bind
        source: /home/ellie/.ssh/known_hosts
        target: /root/.ssh/known_hosts
    networks:
      internal:
        aliases:
          - ds4.apidb.org
  plugin-genelist:
    image: veupathdb/vdi-plugin-genelist:1.3.1
    networks:
      internal:
        aliases:
          - genelist
      monitoring-ext: {}
    volumes:
      - type: bind
        source: /tmp
        target: /datasets
    environment:
      LDAP_SERVER: ds1.apidb.org:389,ds4.apidb.org:389
      ORACLE_BASE_DN: ou=applications,dc=apidb,dc=org
      CUSTOM_PATH: ''
      SITE_BUILD: build-65
      DATASET_INSTALL_ROOT: /datasets
      IMPORT_SCRIPT_MAX_DURATION: ''
      INSTALL_DATA_SCRIPT_MAX_DURATION: ''
      INSTALL_META_SCRIPT_MAX_DURATION: ''
      UNINSTALL_SCRIPT_MAX_DURATION: ''
      CHECK_COMPAT_SCRIPT_MAX_DURATION: ''
      DB_CONNECTION_ENABLED_AMOEBA: false
      DB_CONNECTION_NAME_AMOEBA: AmoebaDB
      DB_CONNECTION_LDAP_AMOEBA: ameb-inc
      DB_CONNECTION_PASS_AMOEBA: blad4nd3r
      DB_CONNECTION_DATA_SCHEMA_AMOEBA: vdi_datasets_dev_n
      DB_CONNECTION_CONTROL_SCHEMA_AMOEBA: vdi_control_dev_n
      DB_CONNECTION_POOL_SIZE_AMOEBA: ''
    depends_on:
      - tunnel_ares13_penn_apidb_org_1521
      - tunnel_ares8_penn_apidb_org_1521
      - tunnel_ares9_penn_apidb_org_1521
      - tunnel_ds1_apidb_org_389
      - tunnel_ares6_penn_apidb_org_1521
      - tunnel_ares10_penn_apidb_org_1521
      - tunnel_ares11_penn_apidb_org_1521
      - tunnel_ds4_apidb_org_389
      - tunnel_ares14_penn_apidb_org_1521
  minio-create-buckets:
    image: veupathdb/minio-mc
    depends_on:
      - minio-external
      - rabbit-external
    networks:
      - internal
    entrypoint: >
      /bin/sh -c " while ! nc -zv minio-external 9000; do sleep 3; done; mc alias set minioc http://minio-external:9000 someToken someSecretKey; mc mb minioc/some-other-bucket; mc policy set public minioc/some-other-bucket; mc event add minioc/some-other-bucket arn:minio:sqs::RABBIT:amqp --event put,delete; exit 0; "

  cache-db:
    image: veupathdb/vdi-internal-db:1.9.0
    environment:
      POSTGRES_USER: someUser
      POSTGRES_PASSWORD: somePassword
      POSTGRES_DB: vdi
    healthcheck:
      test: "pg_isready -U someUser -d vdi"
      interval: 30s
      timeout: 10s
      retries: 5
    networks:
      - internal
    volumes:
      - cache-db-data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
  plugin-isasimple:
    depends_on:
      - tunnel_ares13_penn_apidb_org_1521
      - tunnel_ares8_penn_apidb_org_1521
      - tunnel_ares9_penn_apidb_org_1521
      - tunnel_ds1_apidb_org_389
      - tunnel_ares6_penn_apidb_org_1521
      - tunnel_ares10_penn_apidb_org_1521
      - tunnel_ares11_penn_apidb_org_1521
      - tunnel_ds4_apidb_org_389
      - tunnel_ares14_penn_apidb_org_1521
    image: veupathdb/vdi-plugin-isasimple:1.3.0
    networks:
      internal:
        aliases:
          - isasimple
      monitoring-ext: {}
    volumes:
      - type: bind
        source: /tmp
        target: /datasets
    environment:
      LDAP_SERVER: ds1.apidb.org:389,ds4.apidb.org:389
      ORACLE_BASE_DN: ou=applications,dc=apidb,dc=org
      CUSTOM_PATH: ''
      SITE_BUILD: build-65
      DATASET_INSTALL_ROOT: /datasets
      IMPORT_SCRIPT_MAX_DURATION: ''
      INSTALL_DATA_SCRIPT_MAX_DURATION: ''
      INSTALL_META_SCRIPT_MAX_DURATION: ''
      UNINSTALL_SCRIPT_MAX_DURATION: ''
      CHECK_COMPAT_SCRIPT_MAX_DURATION: ''
      DB_CONNECTION_ENABLED_AMOEBA: false
      DB_CONNECTION_NAME_AMOEBA: AmoebaDB
      DB_CONNECTION_LDAP_AMOEBA: ameb-inc
      DB_CONNECTION_PASS_AMOEBA: blad4nd3r
      DB_CONNECTION_DATA_SCHEMA_AMOEBA: vdi_datasets_dev_n
      DB_CONNECTION_CONTROL_SCHEMA_AMOEBA: vdi_control_dev_n
      DB_CONNECTION_POOL_SIZE_AMOEBA: ''
  tunnel_ares8_penn_apidb_org_1521:
    image: kroniak/ssh-client:3.19
    entrypoint:
      - ssh
      - -tNn
      - -p
      - 2112
      - -o
      - ServerAliveInterval=60
      - -L
      - ares8.penn.apidb.org:1521:ares8.penn.apidb.org:1521
      - epharper@fir.penn.apidb.org
    environment:
      SSH_AUTH_SOCK: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
    volumes:
      - type: bind
        source: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
        target: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
      - type: bind
        source: /home/ellie/.ssh/known_hosts
        target: /root/.ssh/known_hosts
    networks:
      internal:
        aliases:
          - ares8.penn.apidb.org
  tunnel_ares13_penn_apidb_org_1521:
    image: kroniak/ssh-client:3.19
    entrypoint:
      - ssh
      - -tNn
      - -p
      - 2112
      - -o
      - ServerAliveInterval=60
      - -L
      - ares13.penn.apidb.org:1521:ares13.penn.apidb.org:1521
      - epharper@fir.penn.apidb.org
    environment:
      SSH_AUTH_SOCK: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
    volumes:
      - type: bind
        source: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
        target: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
      - type: bind
        source: /home/ellie/.ssh/known_hosts
        target: /root/.ssh/known_hosts
    networks:
      internal:
        aliases:
          - ares13.penn.apidb.org
  kafka:
    environment:
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092
    networks:
      - internal
    ports:
      - "9092:9092"
    image: veupathdb/apache-kafka:3.4.0
    healthcheck:
      test: nc -z localhost 9092 || exit 1
      interval: 30s
      timeout: 10s
      retries: 5
  minio-external:
    image: veupathdb/minio
    depends_on:
      - rabbit-external
    links:
      - rabbit-external
    ports:
      - "9000:9000"
      - "9001:9001"
    networks:
      - internal
      - rabbitmq
    environment:
      MINIO_ROOT_USER: someToken
      MINIO_ROOT_PASSWORD: someSecretKey
      MINIO_NOTIFY_AMQP_ENABLE_RABBIT: "on"
      MINIO_NOTIFY_AMQP_URL_RABBIT: amqp://someUser:somePassword@rabbit-external:5672
      MINIO_NOTIFY_AMQP_EXCHANGE_RABBIT: vdi-bucket-notifications
      MINIO_NOTIFY_AMQP_EXCHANGE_TYPE_RABBIT: direct
      MINIO_NOTIFY_AMQP_ROUTING_KEY_RABBIT: vdi-bucket-notifications
      MINIO_NOTIFY_AMQP_DELIVERY_MODE_RABBIT: 2
      MINIO_NOTIFY_AMQP_DURABLE_RABBIT: "on"
    entrypoint: >
      /bin/sh -c " while ! nc -zv rabbit-external 5672; do sleep 3; done; minio server --console-address ':9001' /data; "

  plugin-bigwig:
    environment:
      LDAP_SERVER: ds1.apidb.org:389,ds4.apidb.org:389
      ORACLE_BASE_DN: ou=applications,dc=apidb,dc=org
      CUSTOM_PATH: ''
      SITE_BUILD: build-65
      DATASET_INSTALL_ROOT: /datasets
      IMPORT_SCRIPT_MAX_DURATION: ''
      INSTALL_DATA_SCRIPT_MAX_DURATION: ''
      INSTALL_META_SCRIPT_MAX_DURATION: ''
      UNINSTALL_SCRIPT_MAX_DURATION: ''
      CHECK_COMPAT_SCRIPT_MAX_DURATION: ''
      DB_CONNECTION_ENABLED_AMOEBA: false
      DB_CONNECTION_NAME_AMOEBA: AmoebaDB
      DB_CONNECTION_LDAP_AMOEBA: ameb-inc
      DB_CONNECTION_PASS_AMOEBA: blad4nd3r
      DB_CONNECTION_DATA_SCHEMA_AMOEBA: vdi_datasets_dev_n
      DB_CONNECTION_CONTROL_SCHEMA_AMOEBA: vdi_control_dev_n
      DB_CONNECTION_POOL_SIZE_AMOEBA: ''
    depends_on:
      - tunnel_ares13_penn_apidb_org_1521
      - tunnel_ares8_penn_apidb_org_1521
      - tunnel_ares9_penn_apidb_org_1521
      - tunnel_ds1_apidb_org_389
      - tunnel_ares6_penn_apidb_org_1521
      - tunnel_ares10_penn_apidb_org_1521
      - tunnel_ares11_penn_apidb_org_1521
      - tunnel_ds4_apidb_org_389
      - tunnel_ares14_penn_apidb_org_1521
    image: veupathdb/vdi-plugin-bigwig:1.3.1
    networks:
      internal:
        aliases:
          - bigwig
      monitoring-ext: {}
    volumes:
      - type: bind
        source: /tmp
        target: /datasets
  plugin-biom:
    volumes:
      - type: bind
        source: /tmp
        target: /datasets
    environment:
      LDAP_SERVER: ds1.apidb.org:389,ds4.apidb.org:389
      ORACLE_BASE_DN: ou=applications,dc=apidb,dc=org
      CUSTOM_PATH: ''
      SITE_BUILD: build-65
      DATASET_INSTALL_ROOT: /datasets
      IMPORT_SCRIPT_MAX_DURATION: ''
      INSTALL_DATA_SCRIPT_MAX_DURATION: ''
      INSTALL_META_SCRIPT_MAX_DURATION: ''
      UNINSTALL_SCRIPT_MAX_DURATION: ''
      CHECK_COMPAT_SCRIPT_MAX_DURATION: ''
      DB_CONNECTION_ENABLED_AMOEBA: false
      DB_CONNECTION_NAME_AMOEBA: AmoebaDB
      DB_CONNECTION_LDAP_AMOEBA: ameb-inc
      DB_CONNECTION_PASS_AMOEBA: blad4nd3r
      DB_CONNECTION_DATA_SCHEMA_AMOEBA: vdi_datasets_dev_n
      DB_CONNECTION_CONTROL_SCHEMA_AMOEBA: vdi_control_dev_n
      DB_CONNECTION_POOL_SIZE_AMOEBA: ''
    depends_on:
      - tunnel_ares13_penn_apidb_org_1521
      - tunnel_ares8_penn_apidb_org_1521
      - tunnel_ares9_penn_apidb_org_1521
      - tunnel_ds1_apidb_org_389
      - tunnel_ares6_penn_apidb_org_1521
      - tunnel_ares10_penn_apidb_org_1521
      - tunnel_ares11_penn_apidb_org_1521
      - tunnel_ds4_apidb_org_389
      - tunnel_ares14_penn_apidb_org_1521
    image: veupathdb/vdi-plugin-biom:1.3.1
    networks:
      internal:
        aliases:
          - biom
      monitoring-ext: {}
  tunnel_ares9_penn_apidb_org_1521:
    image: kroniak/ssh-client:3.19
    entrypoint:
      - ssh
      - -tNn
      - -p
      - 2112
      - -o
      - ServerAliveInterval=60
      - -L
      - ares9.penn.apidb.org:1521:ares9.penn.apidb.org:1521
      - epharper@fir.penn.apidb.org
    environment:
      SSH_AUTH_SOCK: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
    volumes:
      - type: bind
        source: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
        target: /tmp/ssh-XXXXXXbzlfF7/agent.3369064
      - type: bind
        source: /home/ellie/.ssh/known_hosts
        target: /root/.ssh/known_hosts
    networks:
      internal:
        aliases:
          - ares9.penn.apidb.org

