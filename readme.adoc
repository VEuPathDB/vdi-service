= VEuPathDB Dataset Installer Service (VDI)
:source-highlighter: highlightjs
:toc:

ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

ifndef::env-github[]
:icons: font
endif::[]

== Documentation Links

=== Production Service

* link:https://veupathdb.github.io/vdi-service/vdi-api.html[REST Service API Doc]
* Configuration Schema Doc
* Full Configuration Schema
* Configuration Schema Root

=== Development Docs

.API
* link:https://veupathdb.github.io/vdi-service/dev/vdi-api.html[REST Service API Doc]
* link:https://veupathdb.github.io/vdi-service/dev/schema/data/dataset-characteristics.eda.json[EDA Dataset Characteristics Schema]
* link:https://veupathdb.github.io/vdi-service/dev/schema/data/dataset-characteristics.genomics.json[Genomics Dataset Characteristics Schema]
* link:https://veupathdb.github.io/vdi-service/dev/schema/data/dataset-characteristics.metaschema.json[Dataset Characteristiscs Metaschema]

.Service Config
* link:https://veupathdb.github.io/vdi-service/dev/config-schema.html[Configuration Schema Doc]
* link:https://veupathdb.github.io/vdi-service/dev/schema/config/full-config.json[Full Configuration Schema]
* link:https://veupathdb.github.io/vdi-service/dev/schema/config/stack-config.json[Configuration Schema Root]

== Development

=== Running the Stack

. `make build` +
Builds the VDI service docker image.
. `make up` +
Spins up the service.
. `make down` +
Shuts down the service and removes all the vdi-specific containers, volumes,
and networks.


== Repo Structure

The VDI service repository is divided into 2 categories of subproject:
link:lib/[libraries], and link:service[services].

The libraries are self-contained VDI-specific packages that are shared between
different services that require a package's specific tools.

Services, also referred to in code as modules, are independent processes that
share a container/jvm for stack deployment convenience.

=== Services

==== Lanes

Dataset event handlers.  Each lane is a separate process that subscribes to a
Kafka channel and operates on datasets whose information is provided in the
incoming events.

* link:service/lane/hard-delete/[Hard Delete]
* link:service/lane/import/[Import]
* link:service/lane/install/[Install Data]
* link:service/lane/reconciliation/[Reconciliation]
* link:service/lane/sharing/[Share]
* link:service/lane/soft-delete/[Soft Delete]
* link:service/lane/update-meta/[Update Meta]

==== Rest Service

The rest service is the public API through which users and administrators
communicate with and operate on the VDI system.

* link:service/rest-service/[Rest API Service]

==== Daemons

Independent background tasks.

* link:service/daemon/event-router/[MinIO Event Router]
* link:service/daemon/pruner/[Stale Object Pruner]
* link:service/daemon/reconciler/[Dataset Reconciler]

==== Bootstrapper

The bootstrapper is responsible for starting up the service modules listed above
and ensuring a full JVM shutdown if any service module crashes.

* link:service/bootstrap/[Bootstrapper]

=== Internal Libs

.link:lib/dataset/[Dataset Management]
* link:lib/dataset/pruner[Dataset Pruner Implementation]
* link:lib/dataset/reconciler/[Dataset Reconciler Implementation]
* link:lib/dataset/reinstaller/[Dataset Reinstaller]

.link:lib/db/[Database Interaction]
* link:lib/db/application/[Application DB Client]
* link:lib/db/internal/[Internal DB Client]
* link:lib/db/common/[Shared DB Components]

.link:lib/plugin/[Plugin Communication]
* link:lib/plugin/client[Plugin HTTP Client]
* link:lib/plugin/registry/[Enabled Plugin Mapping]

.link:lib/external[External Service APIs]
* link:lib/external/ldap[LDAP Utilities]
* link:lib/external/rabbit[Rabbit Client]
* link:lib/external/s3[MinIO Dataset Management Wrapper]

.Misc
* link:lib/async/[Async Utilities]
* link:lib/common/[Universal Components]
* link:lib/kafka[Kafka Client]
* link:lib/module-core/[Service/Module Core API]
* link:lib/test-utils[Unit Test Utilities]


== VDI Project Repository Links

.Services
* https://github.com/VEuPathDB/vdi-service[VDI Core Service]
* https://github.com/VEuPathDB/vdi-plugin-handler-server[VDI Plugin Handler Service]

.Plugins
* https://github.com/VEuPathDB/vdi-plugin-bigwig[bigWig]
* https://github.com/VEuPathDB/vdi-plugin-biom[BIOM]
* https://github.com/VEuPathDB/vdi-plugin-genelist[Gene List]
* https://github.com/VEuPathDB/vdi-plugin-isasimple[ISA Study]
* https://github.com/VEuPathDB/vdi-plugin-noop[NoOp]
* https://github.com/VEuPathDB/vdi-plugin-wrangler[Phenotype]
* https://github.com/VEuPathDB/vdi-plugin-rnaseq[RNA-Seq]

.Docker Images
* https://github.com/VEuPathDB/vdi-internal-db[Cache DB Docker Image]
* https://github.com/VEuPathDB/docker-gus-apidb-base[Gus/ApiDB Schema Base] +
[.small]#_Not explicitly part of VDI, but the base image for several plugins_#

.Service Libraries
* https://github.com/VEuPathDB/vdi-component-common[Commons Library]
* https://github.com/VEuPathDB/vdi-component-json[JSON Utilities]

.Plugin Libraries
* https://github.com/VEuPathDB/lib-vdi-plugin-rnaseq[lib-rnaseq]
* https://github.com/VEuPathDB/lib-vdi-plugin-study[lib-study]

.Misc
* https://github.com/VEuPathDB/vdi-handler-plugin-example[Example Plugin]
* https://github.com/VEuPathDB/VdiSchema[VDI App DB Schema]
